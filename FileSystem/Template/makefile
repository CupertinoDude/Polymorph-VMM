# 
# :ts=4 
# 

.PHONY: all version revision clean realclean depend

###########################################################################

NAME	= FS_VECTORPORT
VERSION	= 53

###########################################################################

WARNINGS = \
	-Wall -W -Wshadow -Wpointer-arith -Wsign-compare -Wmissing-prototypes \
	-Wundef -Wbad-function-cast -Wmissing-declarations -Wwrite-strings -Werror

CPU = -mcpu=powerpc
OPTIONS = -DNDEBUG -fno-builtin -I/V/include
OPTIMIZE = -O2 -fomit-frame-pointer -fstrength-reduce -finline-functions
DEBUG = -gstabs

###########################################################################

CRT    = clib2
CFLAGS = $(WARNINGS) $(OPTIMIZE) $(DEBUG) $(CPU) $(OPTIONS) -I. -mcrt=$(CRT)
LFLAGS = -L.

###########################################################################

OBJS = \
	start.o \
	change_update.o \
	_FSAddNotify.o \
	_FSChangeFileMode.o \
	_FSChangeFilePosition.o \
	_FSChangeFileSize.o \
	_FSChangeLockMode.o \
	_FSClose.o \
	_FSCreateDir.o \
	_FSCreateHardLink.o \
	_FSCreateSoftLink.o \
	_FSDelete.o \
	_FSDeviceInfoData.o \
	_FSDupLock.o \
	_FSDupLockFromFH.o \
	_FSExamineDir.o \
	_FSExamineFile.o \
	_FSExamineLock.o \
	_FSFileSystemAttr.o \
	_FSFlush.o \
	_FSFormat.o \
	_FSGetFilePosition.o \
	_FSGetFileSize.o \
	_FSInhibit.o \
	_FSLock.o \
	_FSLockRecord.o \
	_FSOpen.o \
	_FSOpenFromLock.o \
	_FSParentDir.o \
	_FSParentOfFH.o \
	_FSRead.o \
	_FSReadSoftLink.o \
	_FSRelabel.o \
	_FSRemoveNotify.o \
	_FSRename.o \
	_FSSameFile.o \
	_FSSameLock.o \
	_FSSerialize.o \
	_FSSetComment.o \
	_FSSetDate.o \
	_FSSetGroup.o \
	_FSSetOwner.o \
	_FSSetProtection.o \
	_FSUnLock.o \
	_FSUnLockRecord.o \
	_FSVolumeInfoData.o \
	_FSWrite.o \
	_FSWriteProtect.o


LIBS = \
	-lc 

###########################################################################

all: $(NAME)

$(NAME): $(OBJS)
	@echo 
	@ppc-amigaos-gcc -o $@.debug $(CFLAGS) $(LFLAGS) -nostdlib $(OBJS) $(LIBS) -Wl,--cref,-M,-Map=$@.map 
	@ppc-amigaos-strip -R.comment -R.dstart -R.dend -R.data -R.sdata -R.sdata2 -R.bss -o $@ $@.debug 

###########################################################################

version:
	bumprev $(VERSION) $(NAME)

revision:
	bumprev $(VERSION) $(NAME)

###########################################################################

clean:
	rm -f *.o 

realclean:
	rm -f *.o $(NAME) *.debug *.map *_rev.i *_rev.s

makefile.depend: ;
	@echo "WARNING: makefile.depend missing. Please run 'make depend'" 

depend:
	@echo "  MK makefile.depend" 
	@echo "  [This may take a minute...]" 
	@echo "# AUTOGENERATED! DO NOT EDIT!!!" >makefile.depend 
	@$(CC) -MM $(CFLAGS) $(patsubst %.o,%.c, $(OBJS)) >>makefile.depend 

## DEPENDENCY INCLUDE #################

-include makefile.depend

###########################################################################

%.o: %.c
	@echo "  $<" 
	@ppc-amigaos-gcc -c $(CFLAGS) -o $*.o $< 


